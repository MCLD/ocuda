name: CI

on: [push, pull_request]

jobs:
  ops:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set Docker image name
      run: echo ::set-env name=BLD_DOCKER_IMAGE::$(echo $GITHUB_REPOSITORY/ops
        | tr '[:upper:]' '[:lower:]')

    - name: Extract Docker username
      run: echo ::set-env name=BLD_DOCKER_USERNAME::$(echo $GITHUB_REPOSITORY
        | cut -d/ -f1
        | tr '[:upper:]' '[:lower:]')

    - name: Run docker-build.bash
      env:
        BLD_DOCKER_HOST: docker.pkg.github.com
        BLD_DOCKER_PASSWORD: ${{secrets.GITHUB_TOKEN}}
        BLD_DOCKERFILE: Dockerfile_ops
      run: ./docker-build.bash

  promenade:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set Docker image name
      run: echo ::set-env name=BLD_DOCKER_IMAGE::$(echo $GITHUB_REPOSITORY/promenade
        | tr '[:upper:]' '[:lower:]')

    - name: Extract Docker username
      run: echo ::set-env name=BLD_DOCKER_USERNAME::$(echo $GITHUB_REPOSITORY
        | cut -d/ -f1
        | tr '[:upper:]' '[:lower:]')

    - name: Run docker-build.bash
      env:
        BLD_DOCKER_HOST: docker.pkg.github.com
        BLD_DOCKER_PASSWORD: ${{secrets.GITHUB_TOKEN}}
        BLD_DOCKERFILE: Dockerfile_promenade
      run: ./docker-build.bash
